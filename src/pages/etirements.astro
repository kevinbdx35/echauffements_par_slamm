---
import Layout from '../layouts/Layout.astro';
const base = import.meta.env.BASE_URL;
const pdfUrl = `${base}etirements.pdf`;
---

<Layout
  title="Étirements de fin de séance"
  description="Programme d'étirements après séance NOGI et MMA — 22 pages"
>
  <div class="mb-6">
    <a href={base} class="text-gray-500 text-sm">← Accueil</a>
    <h1 class="text-2xl sm:text-4xl font-black mt-3 mb-1">Étirements <span class="text-red-500">fin de séance</span></h1>
    <p class="text-gray-400 text-sm mb-3">À faire après chaque séance · 22 pages</p>
    <a
      href={pdfUrl}
      download
      class="text-xs font-semibold bg-gray-800 text-gray-400 border border-gray-700 rounded-full px-3 py-1 inline-block hover:text-white transition-colors"
    >
      ⬇ Télécharger le PDF
    </a>
  </div>

  <div id="loading" class="text-center text-gray-500 py-16">Chargement du PDF…</div>
  <div id="pdf-container" class="flex flex-col gap-3" data-pdf-url={pdfUrl}></div>
</Layout>

<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script is:inline>
  (async function () {
    const container = document.getElementById('pdf-container');
    const loading = document.getElementById('loading');
    const pdfUrl = container.dataset.pdfUrl;

    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    try {
      const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
      loading.remove();

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const containerWidth = container.clientWidth || 700;
        const baseViewport = page.getViewport({ scale: 1 });
        const scale = containerWidth / baseViewport.width;
        const viewport = page.getViewport({ scale });

        const canvas = document.createElement('canvas');
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        canvas.className = 'w-full rounded-xl bg-white';
        container.appendChild(canvas);

        await page.render({
          canvasContext: canvas.getContext('2d'),
          viewport,
        }).promise;
      }
    } catch (e) {
      loading.textContent = 'Impossible de charger le PDF.';
      console.error(e);
    }
  })();
</script>
