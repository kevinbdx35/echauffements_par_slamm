---
interface Props {
  youtubeId: string;
  titre: string;
  start?: number;
}
const { youtubeId, titre, start } = Astro.props;
const thumbnail = `https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg`;
const embedUrl = `https://www.youtube-nocookie.com/embed/${youtubeId}?autoplay=1${start ? `&start=${start}` : ''}`;
---

<div
  class="aspect-video w-full rounded-xl overflow-hidden shadow-lg relative cursor-pointer group"
  data-youtube-id={youtubeId}
  data-embed-url={embedUrl}
>
  <img
    src={thumbnail}
    alt={titre}
    class="w-full h-full object-cover"
    loading="lazy"
  />
</div>

<script>
  document.addEventListener('click', function (e) {
    const el = (e.target as HTMLElement).closest('[data-youtube-id]') as HTMLElement | null;
    if (!el) return;
    const iframe = document.createElement('iframe');
    iframe.src = el.dataset.embedUrl!;
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen = true;
    iframe.className = 'w-full h-full';
    el.innerHTML = '';
    el.appendChild(iframe);
  });
</script>
